if(typeof KJUR=="undefined"||!KJUR){KJUR={}}if(typeof KJUR.crypto=="undefined"||!KJUR.crypto){KJUR.crypto={}}KJUR.crypto.DSA=function(){var c=ASN1HEX,g=c.getVbyList,e=c.getVbyListEx,a=c.isASN1HEX,d=BigInteger,b=BigInteger.ONE;var f=function(j,i,h,k){if(j==null||i==null||h==null||k==null){throw new Error("invalid DSA public key")}if(b.compareTo(i)>=0||i.compareTo(j)>=0){throw new Error("invalid DSA public key")}if(b.compareTo(h)>=0||h.compareTo(j)>=0){throw new Error("invalid DSA public key")}if(b.compareTo(k)>=0||k.compareTo(j)>=0){throw new Error("invalid DSA public key")}if(h.modPow(i,j).compareTo(b)!=0){throw new Error("invalid DSA public key")}};this.p=null;this.q=null;this.g=null;this.y=null;this.x=null;this.type="DSA";this.isPrivate=false;this.isPublic=false;this.setPrivate=function(k,j,i,l,h){this.isPrivate=true;this.p=k;this.q=j;this.g=i;this.y=l;this.x=h};this.setPrivateHex=function(k,i,m,p,q){var j,h,l,n,o;j=new BigInteger(k,16);h=new BigInteger(i,16);l=new BigInteger(m,16);if(typeof p==="string"&&p.length>1){n=new BigInteger(p,16)}else{n=null}o=new BigInteger(q,16);this.setPrivate(j,h,l,n,o)};this.setPublic=function(j,i,h,k){f(j,i,h,k);this.isPublic=true;this.p=j;this.q=i;this.g=h;this.y=k;this.x=null};this.setPublicHex=function(m,l,k,n){var i,h,o,j;i=new BigInteger(m,16);h=new BigInteger(l,16);o=new BigInteger(k,16);j=new BigInteger(n,16);this.setPublic(i,h,o,j)};this.signWithMessageHash=function(m){var j=this.p;var i=this.q;var n=this.g;var t=this.y;var u=this.x;var v=m.substr(0,i.bitLength()/4);var o=new BigInteger(v,16);var l,h,A;do{l=KJUR.crypto.Util.getRandomBigIntegerMinToMax(BigInteger.ONE.add(BigInteger.ONE),i.subtract(BigInteger.ONE));h=(n.modPow(l,j)).mod(i);A=(l.modInverse(i).multiply(o.add(u.multiply(h)))).mod(i)}while(h.compareTo(BigInteger.ZERO)==0||A.compareTo(BigInteger.ZERO)==0);var w=KJUR.asn1.ASN1Util.jsonToASN1HEX({seq:[{"int":{bigint:h}},{"int":{bigint:A}}]});return w};this.verifyWithMessageHash=function(n,m){var k=this.p;var i=this.q;var t=this.g;var x=this.y;var o=this.parseASN1Signature(m);var h=o[0];var D=o[1];var C=n.substr(0,i.bitLength()/4);var u=new BigInteger(C,16);if(BigInteger.ZERO.compareTo(h)>0||h.compareTo(i)>0){throw"invalid DSA signature"}if(BigInteger.ZERO.compareTo(D)>=0||D.compareTo(i)>0){throw"invalid DSA signature"}var A=D.modInverse(i);var l=u.multiply(A).mod(i);var j=h.multiply(A).mod(i);var B=t.modPow(l,k).multiply(x.modPow(j,k)).mod(k).mod(i);return B.compareTo(h)==0};this.parseASN1Signature=function(h){try{var k=new d(e(h,0,[0],"02"),16);var j=new d(e(h,0,[1],"02"),16);return[k,j]}catch(i){throw new Error("malformed ASN.1 DSA signature")}};this.readPKCS5PrvKeyHex=function(l){var m,k,j,n,o;if(a(l)===false){throw new Error("not ASN.1 hex string")}try{m=e(l,0,[1],"02");k=e(l,0,[2],"02");j=e(l,0,[3],"02");n=e(l,0,[4],"02");o=e(l,0,[5],"02")}catch(i){throw new Error("malformed PKCS#1/5 plain DSA private key")}this.setPrivateHex(m,k,j,n,o)};this.readPKCS8PrvKeyHex=function(l){var m,k,j,n;if(a(l)===false){throw new Error("not ASN.1 hex string")}try{m=e(l,0,[1,1,0],"02");k=e(l,0,[1,1,1],"02");j=e(l,0,[1,1,2],"02");n=e(l,0,[2,0],"02")}catch(i){throw new Error("malformed PKCS#8 plain DSA private key")}this.setPrivateHex(m,k,j,null,n)};this.readPKCS8PubKeyHex=function(l){var m,k,j,n;if(a(l)===false){throw new Error("not ASN.1 hex string")}try{m=e(l,0,[0,1,0],"02");k=e(l,0,[0,1,1],"02");j=e(l,0,[0,1,2],"02");n=e(l,0,[1,0],"02")}catch(i){throw new Error("malformed PKCS#8 DSA public key")}this.setPublicHex(m,k,j,n)};this.readCertPubKeyHex=function(l,o){var m,k,j,n;if(a(l)===false){throw new Error("not ASN.1 hex string")}try{m=e(l,0,[0,5,0,1,0],"02");k=e(l,0,[0,5,0,1,1],"02");j=e(l,0,[0,5,0,1,2],"02");n=e(l,0,[0,5,1,0],"02")}catch(i){throw new Error("malformed X.509 certificate DSA public key")}this.setPublicHex(m,k,j,n)}};